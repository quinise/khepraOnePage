<!-- Top Controls: Toggle Button + Filters -->
<div class="row justify-content-center">
  <div class="col">
    <div class="text-end me-5">
      <button mat-raised-button class="float-end mt-0 mb-2 p-2" color="primary" (click)="toggleView()">
        {{ showCalendar ? 'Switch to List View' : 'Switch to Calendar View' }}
      </button>
    </div>
  </div>
  <div class="col"></div>
  <div class="col">
    <div class="row">
      <div class="text-end w-50">
        <mat-form-field appearance="fill" class="mt-4 mb-3">
          <mat-label>{{ showCalendar ? 'Filter Calendar' : 'Filter Appointments and Events' }}</mat-label>
          <mat-select (selectionChange)="onRangeChange($event)" [value]="daysRange">
            <mat-option [value]="3">Within 3 Days</mat-option>
            <mat-option [value]="7">Within 7 Days</mat-option>
            <mat-option [value]="14">Within 14 Days</mat-option>
            <mat-option [value]="30">Within 30 Days</mat-option>
            <mat-option [value]="-1">All Appointments and Events</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <mat-slide-toggle class="mx-auto" [checked]="includePast" (change)="handleIncludePastChange($event.checked)">
        Include Past Appointments and Events
      </mat-slide-toggle>
    </div>
  </div>
</div>

<!-- Calendar View -->
<div class="my-5" *ngIf="showCalendar">
  <app-events [daysRange]="daysRange" [includePast]="includePast"></app-events>
</div>

<!-- Appointment and Event List View -->
<div *ngIf="!showCalendar">
  <!-- Past Appointments and Events (conditionally displayed) -->
  <div *ngIf="includePast">
    <h2 class="text-center">Past Appointments and Events</h2>
    <div class="row">
      <!-- Past Appointments -->
      <div class="col-md-6">
        <h4 class="text-primary">Appointments</h4>
        <div *ngFor="let date of getSortedKeys(filteredPastAppointments)">
          <div class="card mb-3 mx-2">
            <div class="card-header bg-primary text-white">
              {{ date }}
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" *ngFor="let appointment of filteredPastAppointments[date]">
                <strong>Client: {{ appointment.name }}</strong><br>
                {{ appointment.date | date: 'shortTime' }}<br>
                Service: {{ appointment.type }}<br>
                Virtual: {{ appointment.isVirtual ? 'Yes' : 'No' }}<br>
                Email: {{ appointment.email }}<br>
                Phone: {{ appointment.phoneNumber }}
                <button *ngIf="isAdmin" class="btn btn-sm btn-danger mt-2" (click)="deleteAppointment(appointment.id!)">
                  Delete
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Past Events -->
      <div class="col-md-6">
        <h4 class="text-success">Events</h4>
        <div *ngFor="let date of getSortedKeys(filteredPastEvents)">
          <div class="card mb-3 mx-2">
            <div class="card-header bg-success text-white">
              {{ date }}
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" *ngFor="let event of filteredPastEvents[date]">
                <strong>{{ event.eventName }}</strong><br>
                {{ event.startDate | date: 'shortTime' }}<br>
                Type: {{ event.eventType }}<br>
                Virtual: {{ event.isVirtual ? 'Yes' : 'No' }}
                <button *ngIf="isAdmin" class="btn btn-sm btn-danger mt-2" (click)="deleteEvent(event.id!)">
                  Delete
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Future Appointments and Events -->
  <h2 class="text-center mt-5">Future Appointments and Events</h2>
  <div class="row">
    <!-- Future Appointments -->
    <div class="col-md-6">
      <h4 class="text-primary">Appointments</h4>
      <div *ngFor="let date of getSortedKeys(filteredAppointments)">
        <div class="card mb-3 mx-2">
          <div class="card-header bg-primary text-white">
            {{ date }}
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item" *ngFor="let appointment of filteredAppointments[date]">
              <strong>Client: {{ appointment.name }}</strong><br>
              {{ appointment.date | date: 'shortTime' }}<br>
              Service: {{ appointment.type }}<br>
              Virtual: {{ appointment.isVirtual ? 'Yes' : 'No' }}
              <button *ngIf="isAdmin" class="btn btn-sm btn-danger mt-2" (click)="deleteAppointment(appointment.id!)">
                Delete
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Future Events -->
    <div class="col-md-6">
      <h4 class="text-success">Events</h4>
      <div *ngFor="let date of getSortedKeys(filteredEvents)">
        <div class="card mb-3 mx-2">
          <div class="card-header bg-success text-white">
            {{ date }}
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item" *ngFor="let event of filteredEvents[date]">
              <strong>{{ event.eventName }}</strong><br>
              {{ event.startDate | date: 'shortTime' }}<br>
              Type: {{ event.eventType }}<br>
              Virtual: {{ event.isVirtual ? 'Yes' : 'No' }}
              <button *ngIf="isAdmin" class="btn btn-sm btn-danger mt-2" (click)="deleteEvent(event.id!)">
                Delete
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>